<script type="text/javascript">
var RCAS = (function () {
    function captureSVG (that, selector) {
        var svg  = document.querySelector(selector).parentNode,
            inner = svg.innerHTML,
            data = 'data:image/svg+xml;base64,' + btoa('<svg>'+inner+'</svg>');

        // override link target
        that.href = data;
        return true;
    }

    function generateModebarButton (selector) {
        var el     = document.createElement('div'),
            button = '<a href=# download="rcas.svg" onClick=\'RCAS.captureSVG(this, "'+
            selector + '")\' ' +
            'data-gravity="n" data-toggle="false" data-title="Download plot as a SVG" class="modebar-btn" rel="tooltip">' +
            '<svg viewBox="0 0 1000 1000" width="1em" height="1em">'+
            '<path transform="matrix(1 0 0 -1 0 850)" d="m500 450c-83 0-150-67-150-150 0-83 67-150 150-150 83 0 150 67 150 150 0 83-67 150-150 150z m400 150h-120c-16 0-34 13-39 29l-31 93c-6 15-23 28-40 28h-340c-16 0-34-13-39-28l-31-94c-6-15-23-28-40-28h-120c-55 0-100-45-100-100v-450c0-55 45-100 100-100h800c55 0 100 45 100 100v450c0 55-45 100-100 100z m-400-550c-138 0-250 112-250 250 0 138 112 250 250 250 138 0 250-112 250-250 0-138-112-250-250-250z m365 380c-19 0-35 16-35 35 0 19 16 35 35 35 19 0 35-16 35-35 0-19-16-35-35-35z"></path>'+
            '</svg>'+
            '</a>';

        el.innerHTML = button;
        el.className = 'modebar-group';
        return el;
    }

    function injectLink (pathToWidget) {
        var widget = document.getElementById(pathToWidget),
            button = generateModebarButton('#' + pathToWidget + ' .main-svg'),
            bar    = widget.getElementsByClassName('modebar')[0];
        // insert at the very beginning
        bar.insertBefore(button, bar.firstChild.nextSibling);
    }

    // inject links in every widget
    function init () {
        var nodes = document.getElementsByClassName('js-plotly-plot');
        for (var i = 0; i < nodes.length; i++) {
            injectLink(nodes[i].id);
        }
    }

    return {
        captureSVG: captureSVG,
        init: init
    };
})();

window.onload = RCAS.init;
</script>
